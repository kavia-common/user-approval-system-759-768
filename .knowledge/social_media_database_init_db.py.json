{"is_source_file": true, "format": "Python", "description": "This is a Python script for initializing and migrating an SQLite database used in a social media database project. It handles database setup, migrations, seeding data, and generating connection files.", "external_files": ["migrations/*.py", "seeds/*.py", "db_visualizer/sqlite.env", "db_shell.py"], "external_methods": ["os.getenv", "os.path.abspath", "os.getenv", "Path.mkdir", "Path.glob", "sqlite3.connect", "conn.execute", "conn.cursor", "conn.fetchall", "conn.commit", "conn.rollback", "os.remove", "sys.argv"], "published": [], "classes": [], "methods": [{"name": "str get_db_path()", "description": "Resolves the database file path using environment variable SQLITE_DB or default filename.", "scope": "", "scopeKind": ""}, {"name": "ensure_dirs()", "description": "Creates necessary directories for migrations, seeds, helpers, and visualizer.", "scope": "", "scopeKind": ""}, {"name": "sqlite3.Connection connect(db_path: str)", "description": "Creates a SQLite connection with foreign key constraints enabled.", "scope": "", "scopeKind": ""}, {"name": "init_migrations_table(conn: sqlite3.Connection)", "description": "Creates the schema_migrations table if it doesn't exist.", "scope": "", "scopeKind": ""}, {"name": "set[str] get_applied_migrations(conn: sqlite3.Connection)", "description": "Retrieves a set of filenames of migrations already applied to the database.", "scope": "", "scopeKind": ""}, {"name": "list[str] run_migrations(conn: sqlite3.Connection, migrations_dir: Path)", "description": "Runs pending migration scripts in order and records their application.", "scope": "", "scopeKind": ""}, {"name": "write_connection_info(db_path: str)", "description": "Writes database connection details and environment variables to files.", "scope": "", "scopeKind": ""}, {"name": "seed_data(conn: sqlite3.Connection, seeds_dir: Path)", "description": "Runs seed scripts to populate the database with initial data.", "scope": "", "scopeKind": ""}, {"name": "reset_db(db_path: str)", "description": "Deletes the existing database file to reset the database.", "scope": "", "scopeKind": ""}, {"name": "parse_args()", "description": "Parses command line arguments for seed and reset options.", "scope": "", "scopeKind": ""}, {"name": "main()", "description": "Main execution function that orchestrates database initialization, migration, optional seeding, and setup.", "scope": "", "scopeKind": ""}], "calls": ["exec", "compile", "os.path.exists", "os.path.remove", "Path.touch", "os.getenv", "Path.mkdir", "Path.glob", "sqlite3.connect", "conn.execute", "conn.cursor", "conn.fetchall", "conn.commit", "conn.rollback", "sys.argv"], "search-terms": ["database migration", "SQLite initialization", "migration scripts execution", "seeding scripts", "initial setup", "schema_migrations table", "migration timestamp", "seed scripts", "visualizer env", "db connection file"], "state": 2, "file_id": 9, "knowledge_revision": 20, "git_revision": "89bd3e0ffec5c2a134acacc7ba3aaf3cf9a1065c", "revision_history": [{"18": "89bd3e0ffec5c2a134acacc7ba3aaf3cf9a1065c"}, {"20": "89bd3e0ffec5c2a134acacc7ba3aaf3cf9a1065c"}], "ctags": [{"_type": "tag", "name": "DEFAULT_DB", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-759-768/social_media_database/init_db.py", "pattern": "/^DEFAULT_DB = \"myapp.db\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "connect", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-759-768/social_media_database/init_db.py", "pattern": "/^def connect(db_path: str) -> sqlite3.Connection:$/", "language": "Python", "typeref": "typename:sqlite3.Connection", "kind": "function", "signature": "(db_path: str)"}, {"_type": "tag", "name": "ensure_dirs", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-759-768/social_media_database/init_db.py", "pattern": "/^def ensure_dirs():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_applied_migrations", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-759-768/social_media_database/init_db.py", "pattern": "/^def get_applied_migrations(conn: sqlite3.Connection) -> set[str]:$/", "language": "Python", "typeref": "typename:set[str]", "kind": "function", "signature": "(conn: sqlite3.Connection)"}, {"_type": "tag", "name": "get_db_path", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-759-768/social_media_database/init_db.py", "pattern": "/^def get_db_path() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "init_migrations_table", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-759-768/social_media_database/init_db.py", "pattern": "/^def init_migrations_table(conn: sqlite3.Connection):$/", "language": "Python", "kind": "function", "signature": "(conn: sqlite3.Connection)"}, {"_type": "tag", "name": "main", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-759-768/social_media_database/init_db.py", "pattern": "/^def main():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "parse_args", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-759-768/social_media_database/init_db.py", "pattern": "/^def parse_args():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "reset_db", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-759-768/social_media_database/init_db.py", "pattern": "/^def reset_db(db_path: str):$/", "language": "Python", "kind": "function", "signature": "(db_path: str)"}, {"_type": "tag", "name": "run_migrations", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-759-768/social_media_database/init_db.py", "pattern": "/^def run_migrations(conn: sqlite3.Connection, migrations_dir: Path) -> list[str]:$/", "language": "Python", "typeref": "typename:list[str]", "kind": "function", "signature": "(conn: sqlite3.Connection, migrations_dir: Path)"}, {"_type": "tag", "name": "seed_data", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-759-768/social_media_database/init_db.py", "pattern": "/^def seed_data(conn: sqlite3.Connection, seeds_dir: Path):$/", "language": "Python", "kind": "function", "signature": "(conn: sqlite3.Connection, seeds_dir: Path)"}, {"_type": "tag", "name": "write_connection_info", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-759-768/social_media_database/init_db.py", "pattern": "/^def write_connection_info(db_path: str):$/", "language": "Python", "kind": "function", "signature": "(db_path: str)"}], "hash": "73a4b7ceb9471c131779275e45c72c50", "format-version": 4, "code-base-name": "social_media_database", "filename": "social_media_database/init_db.py", "fields": [{"name": "DEFAULT_DB = \"myapp.db\"", "scope": "", "scopeKind": "", "description": "unavailable"}]}